\chapter{Discussion}

\section{Overview}

The majority of this work was focused on the open-source development of new methods and tools. This method of development served two purposes; the first was to start the lower limb exoskeleton development in the AIM lab, and the second was to provide tools for other researchers to build and develop their own exoskeleton without having to rebuild the fundamental building blocks and tools required to conduct motion capture research, use the AMBF simulation package, and build an exoskeleton. 


\section{Mechanical Development}

The development of lower limb exoskeletons should be designed to meet the person's needs. It should mimic natural gait motion and provide the necessary torques to the joints. Additionally, the exoskeletons must not have sharp edges or pinch points that could harm the person; this is especially important because people with SCI have limited sensory ability and would not be able to if they are injured. 

One of the primary goals of the development of LARRE was to assemble and provide models for other researchers to use, develop, and improve their own lower limb exoskeletons. The current lower limb exoskeletons on the market are expensive and cannot be easily accessed by researchers. Releasing the open-source components allows others to develop on top of the base platform, which is crucial for new software and hardware research so the development can be advanced further. The modular nature of LARRE enables other systems to build upon the base model of LARRE. 

This dissertation developed and tested two knee mechanisms, the wrap-spring clutch knee and the bio-knee; each has its unique pros and cons. The wrap-spring clutch knee is designed for passive motion and support. It does not require a motor for actuation since it relies on the swing motion of the leg. Without the need for a motor, the knee has less mass, which lowers the hip motor's overall inertia and allows for a power-efficient system. It was shown that this design could withstand the anticipated force for a prolonged period of time.   

The bio-knee is focused on attempting to replicate the underlying biomechanics of a knee. It attempts to lower the stress on the person by not simplifying the knee joint to a simple pin joint. Integrating a Maxon motor and Harmonic gearbox into the knee allows the knee to be powered and used for actuation and trajectory control; this has the advantage of being used for precise control of the knee. Additionally, the knee is simple to build and customizable to the individual. Unlike other systems that use complicated cams or pulls, this design has a single part that can be customized, ideal for personalized medicine since it can be quickly and easily manufactured. The disadvantage is that it adds complexity and additional mass and inertia into the system. The additional mass and inertia make it more difficult to be carried by the hip motors and gearboxes.

MRI provides a rich set of data for the analysis of exoskeletons. They allow for comparing the exoskeleton position to the underlying bone structure. It can be used to compare the joint alignment between the human and the exoskeleton. Doing such an experiment comes with many challenges; the first is that the exoskeletons must be made MRI compatible. The devices cannot use any metal or magnetic material, which will distort the image, resulting in the need for a separate MRI-specific device to be manufactured. Secondly, the MRI bore size is limited, making it difficult to strap large devices to a person during a scan. Also, the joint angles and body positions are limited. Care must be taken to position the device to capture it by the field of view and is not affected by the coil. 

The MRI results of the knee scans were inconclusive. There were several limitations to the MRI study that could have contributed to the results. The first limitation is the manual alignment of the knee braces on the person. Care was taken to attempt to align the brace with the anatomy but it could have been misplaced. The second limitation is the strap attachments, they were not forum fitting to the subject soft tissue which could also lead to distortion of the alignment. The third limitation is that the brace shifted when the subjects leg was moved to different angles. Future solutions can address this limitations by developing better straps for the knee that anchor to more secure points and conform better to the subjects soft tissue. 

A limitation of LARRE is that it is constrained to the sagittal plane. This limitation does not affect the gait planning, and the joint trajectories remain the same. An extra degree of freedom can be added to the back of the hip to allow for side-to-side motion. The extra joint would be made passive and allow side-to-side motion; this will add complexity to the dynamics model since it needs to account for additional degrees of freedom.  

\section{Open Source Software and Human Motion Data}

Several software packages were developed to enable the research presented in this dissertation. The open-source toolkits enable other researchers to access and study their data using a well-built API; the Vicon toolkit fills in a need gap in the tools provided in marker analysis. The Vicon toolkit provides the marker's lower-level access and linear algebra tools to transform and manipulate the markers. While other software packages provide tools to examine human motion, they do not necessarily allow direct access to the markers or rigid bodies. In contrast, the Vicon toolkit does offer these tools, which is essential since the marker contains vital information. This information can be used for learning motion and comparing the relative position of markers over the trial. 

This dissertation released additional gait and stair climbing data for others to use. This gait data contains rich marker information to study and examine how people move. By releasing the data to the community, others can study gait motion without conducting their own human motion trials; this can be expensive and time-consuming. 

The limitation of a fixed hip position requires the stairs to be within the support polygon of the exoskeleton. An inverted pendulum model can be used to control the stability of the exoskeleton \cite{chen2018dynamic}. During a gait cycle or stair climbing motion, a high-level controller will have to monitor the stability of the exoskeleton to prevent the exoskeleton from falling. The controller would prioritize keeping the person upright and preventing falling.   DMPS allows the online path to be altered while still driving towards the final goal. The controller should ensure that the final point is within the support polygon of the exoskeleton. The support polygon area can be increased with a crutch that supports the upper body. Additionally, the exoskeleton needs to be a set distance away from the staircase to plan the motion. The planning to the correct place in front of the staircase can be done using a LIDAR or distance sensor to walk the exoskeleton to the correct distance. LARRE has built-in sensors to accomplish this exact measurement for planning. 

The trajectories were trained in both task and joint space. The joint space trajectories offer the benefit that joint motion can be directly learned and applied to the control system since motors control the legs of the exoskeleton. Additionally, it ensures that the natural joint motion is learned and can be replicated on the exoskeleton. If the trajectories are learned in task space, inverse kinematics must be used to calculate the joint trajectories. The joint tractories are used to generate the commands of the leg motors and have the benefit of abstraction and precise foot placement. The start and goal points can be manipulated relative to the hip frame for step planning. However, since inverse kinematics are used to calculate the joint angles, they are not guaranteed to follow natural joint trajectories.   

The open-source software and gait data provide a complete package of rich open-source data and powerful tools to manipulate and analyze the data. The collected gait data was used to learn generalized gait cycles and climb stairs. The various trials' gait cycles can be easily compared and used to learn a generalized trajectory using the open-source toolkit. 

Motion capture does have its limitations and cannot be used for all human analyses. Motion capture was attempted to measure the variable center of rotation when designing the bio-joint. The difficulty in this approach is that current calculating methods require either assuming a pin joint or sphere, requiring marker position over many sequential frames, or both. Both assumptions are incompatible with the core design of the bio joint. The joint assumes that the knee is not a pin, so those methods cannot be used. The methods that use sequential frames cannot be used since we need to measure instance joint center of rotation through the knee motion, so those methods cannot be used. Additionally, even if these obstacles can be overcome, other problems are inherited from motion capture. The mocap markers are placed on the subject's skin, which stretches as the subject moves; this movement is usually treated as noise and has been widely studied, but the recorded movement does not represent the motion of underlying bone structures. The skin and muscle that the markers sit on top of change the motion too much for the rotation-translation to be accurately measured. It should be noted that using the center of rotation is not the same point as used in existing literature, which uses the initial contacted point between the femur and tibia head and tracks that point through the range of motion.



\section{Learning and Generalizing Motion}


Using multiple human demonstrations allows for generalized trajectories to be learned. The task space motion was learned in the sagittal plane since the exoskeleton was also constrained to that plane. The presented method can be generalized to allow motion in all planes by encoding the marker position along all axes, allowing the foot trajectory to be trained in three dimensions. These generalized trajectories can be replicated and reproduced. The leg length can be encoded into the model allowing for abstraction by using multiple demonstrations;  this was shown by using the stair trajectories to generate joint trajectories for different stair heights and is crucial since it shows that a limited data set can be used to generate a wide variety of joint trajectories. Additionally, the data quality must be reasonable; missing or mislabeled markers will affect the demonstration. It is essential to post-process the data to ensure that marker information illustrates the intended motion. 

Multiple trajectories can be used for training and reproduction using the GMM process with DMPs. Smoothing on the training demonstrations decreases the metric of imitation for the training model. Ensuring that the demonstrations are continuously differentiable, the forcing function accurately produces the desired motion. The smoothing modification for DTW can be used to increase the accuracy of the learned model. 

The basic GMM does not do well in replicating orientation trajectories recorded from a surgical or industry robot. This problem is due to the gimbal lock, which can cause the demonstrations to wrap around and have sharp jumps in the motion. The sharp jumps can be seen in demonstrated surgical tasks. This problem could potentially be solved by converting the Euler angles into quaternions that do not suffer from gimbal lock; this does not alter the underlying method of GMM but does require a slightly different for measuring the distance between points. The QGMM is currently being implemented in the open-source GMM framework for community use and development for future applications. 

The LfD methods can also be used to learn specific motions designed by a physical therapist. The training can either be conducted using a motion capture system or directly using the joint sensors of the exoskeleton. The therapist can move the exoskeleton through motions to focus on different exercises based on the person's needs; this can be applied to upper and lower limb exercises. This method can be used to handle muscle sparsity and joint limitation caused by muscle contractures   \cite{hayes2014neuromuscular,james2001contractures}. 

\section{AMBF and Dynamic Server}


The AMBF simulation is still new and experimental. It is not yet ready for the control of a bipedal walking pattern. There are still frictional patterns that need to be overcome to allow the foot to contact the ground and prevent the model from sliding. However, if the simulation is used for contactless dynamics trajectory tracking, it works well. The AMBF simulation was used to test the various controllers to test the real-time control. The AMBF simulation platform has much potential for future application and testing of controllers and models. 

The open-source dynamics and controller server expands the functionality of AMBF by allowing the dynamics of the model to be calculated for use in custom controllers. The dynamics server parses the AMBF model files into the RBDL model. This pipeline ensures that the RBDL model matches the AMBF model, which is critical for model-based controllers. Additionally, using a ROS abstraction layer allows the developer to use any language to communicate with the server; this is important for community use and development since the community does not need to understand the kinematics and dynamics of their robot to build a controller. The controller server perfectly meshes with the dynamics server to build a concise pipeline to control robots in the AMBF. This package was released open-source for community development. Releasing open-source packages is crucial for proper research; it allows others to build and expand research without rebuilding and redeveloping everything accomplished previously.   


\section{Exoskeleton Controllers}

The controller was designed to be used in a controlled environment absent external obstacles and the presence of a physical therapist. Currently, there is only one lower limb exoskeleton has been given FDA approval, the ReWalk \footnote{https://ir.rewalk.com/news-releases/news-release-details/rewalktm-personal-exoskeleton-system-cleared-fda-home-use}. There are numerous problems with deploying a lower limb exoskeleton in the field; the most significant concern is safety. If the person falls, they can come injured and unable to get themselves up. Lower limb exoskeletons are still used primarily in rehabilitation environments because of this concern. An additional term to account for external disturbances can be added to the A-SMC controller to remove this assumption in the future. This term will be treated as noise, the A-SMC controller is already robust enough to handle disturbances, so it can be generalized to handle external forces. 

The two controllers developed in this dissertation were the iLQR and the A-SMC cooperative controller. Both expanded on the current models and added new features. The iLQR controller incorporated non-linear models to overcome the limitation of linear models and incorporated the output parameters of GMM to calculate the path and co-variance values along the desired motion. This methodology allows all but the $R$ matrix to be calculated in a concise pipeline from demonstration collection to the generation of the torques. The $R$ matrix can be calculated using a gradient descent method. However, due to the nature of the iLQR controller, it is not suitable for real-time control since the torque has to be calculated offline; this can be overcome using an iLQR torque as a feed-forward term and a PD controller for rejection of closed-loop disturbance. Additionally, it is well suited to be combined with the A-SMC for the standard interaction torque. 

The presented A-SMC controller expands on the literature by introducing a closed-loop human controller and an iLQR input as the standard interaction torque. The closed-loop human controller can simulate an FES-type controller, typical for hybrid lower limb exoskeletons. It shows that the A-SMC controller was able to adapt to the changing torque provided by the human. The A-SMC controller produced lower torque when the human controller provided sufficient torque and produced more when the human controller could not provide enough torque. The A-SMC was also able to adapt on the fly to torque changes that could arise during fatigue. This controller can be used on other assistive exoskeleton devices, such as hand orthosis. If the user cannot or has trouble opening and closing their hand, the controller can provide assistive torques to help in the motion. 

The tuning methodology presented to tune the A-SMC allows for the 
parameters of the controller to be optimally tuned. This contribution is valuable since the A-SMC controller has many parameters scaled with the system's dimensionality. These parameters have complex coupling making it difficult to tune by hand and can lead to non-optimal parameter selection. The presented method is capable of tuning high parameter systems and is designed to optimize a cost function to ensure the parameters find local minima. Different cost functions are used during the optimization processes, including minimizing energy,  a smooth trajectory, or tracking.   



\input{Chapters/futurework}