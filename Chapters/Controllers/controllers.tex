\chapter{Exoskeleton Controllers}

\section{Introduction}

Controllers are a key aspect of lower limb exoskeletons; they allow the exoskeleton to move through desired motions. Different controllers have been developed to control the motion of the exoskeleton and human. A large aspect of these controllers is designed to consider the exoskeleton's dynamics model, allowing the non-linear dynamics to be canceled out when computing the control input. LARRE is assumed to be non-linear and modeled by \autoref{eq:Dyn} where $M$ is the mass-inertia matrix, $C$ is the Coriolis terms, $G$ is the gravity terms. This is similar to other models discussed in \cite{huo2016active} \cite{vantilt2019model}.

\begin{equation}
    \tau = M(q) \ddot{q} + C(q, \dot{q}) \dot{q} + G(q)
    \label{eq:Dyn}
\end{equation}


Several assumptions are made in the design of the controllers. First, the ground force reactions cannot be measured, which prevents feedback from the step. Second, human effort can be measured, and this is directly done through the simulation package. This measurement can be replicated on a physical exoskeleton using force sensing resistors or IMUs in the legs of the system. Third, the exoskeleton gait speed is slow. Gait training using an exoskeleton has been shown to improve the gait speed of paraplegics. The average walking speed after training was on average $0.43m/s$ \cite{khan2019retraining} compared to the average walking speed of a person is $1.5m/s$ \cite{fitzpatrick2006another}. A slow gait can be defined between $0.8-1.0m/s$. The expected gait speed is about half of the low end of a typical slow gait \cite{walsh2007quasi}; this means that the expected gait speed is on average less than $1/3$ of a normal gait speed. 

Two different controllers are presented; the first is an iLQR controller, the second is a cooperative controller. The iLQR controller takes advantage of learning from demonstration and optimal controller theory to generate an optimal control signal to control the exoskeleton. The cooperative controller is designed to provide assistive control commands to combine the person's torques and the exoskeleton. It enables the exoskeleton only to provide the difference in torque between the required and what the person provides. 

All the controllers are implemented using the control architecture discussed in \autoref{sec:controlarchitecture}â€”the modular control system allowed for controllers to be quickly implemented and tested. The RBDL library allowed for the fast computation of the dynamics of the exoskeleton allowing for real-time control. 

% The controller presented in \cite{martinez2017controller} was implemented on the Indigo exoskeleton and used a combination of force fields and human demonstration data to control the movement of the exoskeleton joints. This method did not consider the mass of dynamics of the exoskeleton and was designed to work on stroke patients with unilateral control. 


\input{Chapters/Controllers/iLQR_Controller}
\input{Chapters/Controllers/optimization}


\section{Contributions}

Several contributions were made to the field of controller development. Both the iLQR controller and the A-SMC cooperative controller introduced new methods that expand on previous applications and research. Both the controller have application outside the field outside of lower limb exoskeletons. The generalized forms of the controller can be used for assastive control applications and to generate optimal control signals for non-linear robotic systems. 


The iLQR controller introduced a new method of integrating an optimal controller with learning from demonstration to control a lower limb exoskeleton. This controller method allows a trajectory to be learned from multiple demonstrations and uses a non-linear dynamic model to learn an optimal control signal.  Using a non-linear model allows for the complex dynamics to be encoded into the control signal. The PD controller allows feedback to account for non-modeled dynamics. 



The new tuning method of an A-SMC controller was presented, allowing for the parameters to be automatically determined. This method was shown to improve the state space of the SMC. Using a position and velocity cost function allows for the gains to be automatically tuned to the system. This generalization of the tuning method allows it to be used for more complex systems with more joints or complex dynamics.  Additionally, it was shown that the controller was able to handle varying alignment and involvements of the \textit{assitie} system; this is important since these controllers are often incorporated into \textit{assistive} exoskeleton systems. 

